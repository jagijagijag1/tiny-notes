---
title: Go + WebAssembly お試し
date: 2020-05-16T16:53:38+0900
tags:
- Go
- WebAssembly
categories:
- 開発メモ
author: jagijagijag1

status: public
created_at: 2020-05-16 16:53:38 +0900
updated_at: 2020-05-16 16:56:19 +0900
published_at: 2020-05-16 16:53:38 +0900
---
## WebAssembly
ref: [WebAssembly \| MDN](https://developer.mozilla.org/ja/docs/WebAssembly)

- モダンなウェブブラウザーで実行できる新しいタイプのコード
  - ネイティブに近いパフォーマンスで動作するコンパクトなバイナリー形式の低レベルなアセンブリ風言語
  - C/C++ や Rust のような言語のコンパイル対象となって、それらの言語をウェブ上で実行することができる
  - JavaScript と並行して動作するように設計されているため、両方を連携させることができる
    - WebAssembly JavaScript API を使用して、 WebAssembly モジュールを JavaScript アプリケーションにロードし、2 つの間で機能を共有
    - これにより、WebAssembly コードの記述方法を知らなくても、 WebAssembly のパフォーマンスとパワー、JavaScript の表現力と柔軟性を同じアプリケーションで活用
- ウェブ上で動作するクライアントアプリケーションのために、複数の言語で記述されたコードをウェブ上でネイティブに近いスピードで実行可能

## Hello sample
- wasmを動かすjsファイルと，wasmを読み込むhtmlファイルをとってくる
  - htmlでは`test.wasm`を参照

```bash
cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" .
curl -sO https://raw.githubusercontent.com/golang/go/master/misc/wasm/wasm_exec.html
```

- goファイルを書く

```go:main.go
package main

import "fmt"

func main() {
	fmt.Println("Hello wasm!")
}
```

- コンパイルする

```bash:
GOOS=js GOARCH=wasm go build -o test.wasm main.go
```

- サーバを立ててる

```go:server.go
package main

import (
	"flag"
	"log"
	"net/http"
)

var (
	listen = flag.String("listen", ":8080", "listen address")
	dir    = flag.String("dir", "", "directory to serve")
)

func main() {
	flag.Parse()
	log.Printf("listening on %q...", *listen)
	log.Fatal(http.ListenAndServe(*listen, http.FileServer(http.Dir(*dir))))
}
```

```bash
go run server.go
```

- `http://localhost:8080/wasm_exec.html`にアクセスしRunボタンを押して，コンソール出力されることを確認

## 所感
- フロントの処理をGoとかRustでかけるの面白い，性能いいのかな
- サンプル見るにDOM操作とか書くのしんどいんだけどライブラリとかあるのかな
  - ないとjquery以前に戻ってる気が
